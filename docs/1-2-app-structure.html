<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="1.2 App Structure | Building Web Apps with R Shiny" />
<meta property="og:type" content="book" />
<meta property="og:url" content="https://debruine.github.io/shinyintro/" />
<meta property="og:image" content="https://debruine.github.io/shinyintro//images/shinyintro_card.png" />
<meta property="og:description" content="This class will teach you the basics of Shiny app programming, giving you skills that will form the basis of almost any app you want to build. By the end of the class, you will have created a custom app that collects and saves data, allows users to dynamically visualize the data, and produces downloadable reports." />
<meta name="github-repo" content="debruine/shinyintro" />

<meta name="author" content="Lisa DeBruine" />

<meta name="date" content="2021-07-26" />


<meta name="description" content="This class will teach you the basics of Shiny app programming, giving you skills that will form the basis of almost any app you want to build. By the end of the class, you will have created a custom app that collects and saves data, allows users to dynamically visualize the data, and produces downloadable reports.">

<title>1.2 App Structure | Building Web Apps with R Shiny</title>

<script src="libs/header-attrs-2.9.4/header-attrs.js"></script>
<link href="libs/tufte-css-2015.12.29/tufte-fonts.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-background.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte-italics.css" rel="stylesheet" />
<link href="libs/tufte-css-2015.12.29/tufte.css" rel="stylesheet" />
<meta property="og:title" content="ShinyIntro">
<meta property="og:description" content="1.2 App Structure | Building Web Apps with R Shiny">
<meta property="og:image" content="https://debruine.github.io/shinyintro/images/shinyintro_card.png">
<meta property="og:url" content="https://debruine.github.io/shinyintro/">
<meta property="twitter:card" content="summary_large_image">

<link rel="shortcut icon" href="https://debruine.github.io/shinyintro/images/shinyintro.png">


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="include/psyteachr.css" type="text/css" />
<link rel="stylesheet" href="include/webex.css" type="text/css" />
<link rel="stylesheet" href="include/style.css" type="text/css" />

</head>

<body>



<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#overview">Overview</a>
<ul>
<li><a href="0-1-installing-shinyintro.html#installing-shinyintro"><span class="toc-section-number">0.1</span> Installing shinyintro</a></li>
<li><a href="0-2-example-apps.html#example-apps"><span class="toc-section-number">0.2</span> Example Apps</a></li>
<li><a href="0-3-code-horizons-course-27-30-july-2021.html#code-horizons-course-27-30-july-2021"><span class="toc-section-number">0.3</span> Code Horizons Course (27-30 July 2021)</a>
<ul>
<li><a href="0-3-code-horizons-course-27-30-july-2021.html#schedule"><span class="toc-section-number">0.3.1</span> Schedule</a></li>
</ul></li>
<li><a href="0-4-computing.html#computing"><span class="toc-section-number">0.4</span> Computing</a></li>
<li><a href="0-5-who-should-register.html#who-should-register"><span class="toc-section-number">0.5</span> Who Should Register?</a></li>
<li><a href="0-6-conventions.html#conventions"><span class="toc-section-number">0.6</span> Conventions</a></li>
<li><a href="0-7-further-resources.html#further-resources"><span class="toc-section-number">0.7</span> Further Resources</a></li>
</ul></li>
<li><a href="1-first-app.html#first-app"><span class="toc-section-number">1</span> Your First Shiny App</a>
<ul>
<li><a href="1-1-the-demo-app.html#the-demo-app"><span class="toc-section-number">1.1</span> The Demo App</a>
<ul>
<li><a href="1-1-the-demo-app.html#set-up-the-demo-app"><span class="toc-section-number">1.1.1</span> Set Up the Demo App</a></li>
<li><a href="1-1-the-demo-app.html#modify-the-demo-app"><span class="toc-section-number">1.1.2</span> Modify the Demo App</a></li>
<li><a href="1-1-the-demo-app.html#add-new-things"><span class="toc-section-number">1.1.3</span> Add New Things</a></li>
</ul></li>
<li><a href="1-2-app-structure.html#app-structure"><span class="toc-section-number">1.2</span> App Structure</a>
<ul>
<li><a href="1-2-app-structure.html#ui"><span class="toc-section-number">1.2.1</span> UI</a></li>
<li><a href="1-2-app-structure.html#tags"><span class="toc-section-number">1.2.2</span> Tags</a></li>
<li><a href="1-2-app-structure.html#page-layout"><span class="toc-section-number">1.2.3</span> Page Layout</a></li>
</ul></li>
<li><a href="1-3-dynamic-elements.html#dynamic-elements"><span class="toc-section-number">1.3</span> Dynamic Elements</a>
<ul>
<li><a href="1-3-dynamic-elements.html#inputs-intro"><span class="toc-section-number">1.3.1</span> Inputs</a></li>
<li><a href="1-3-dynamic-elements.html#outputs-intro"><span class="toc-section-number">1.3.2</span> Outputs</a></li>
<li><a href="1-3-dynamic-elements.html#action-buttons"><span class="toc-section-number">1.3.3</span> Action buttons</a></li>
</ul></li>
<li><a href="1-4-first-reactive.html#first-reactive"><span class="toc-section-number">1.4</span> Reactive functions</a></li>
<li><a href="1-5-resources-first-app.html#resources-first-app"><span class="toc-section-number">1.5</span> Further Resources</a></li>
<li><a href="1-6-exercises-first-app.html#exercises-first-app"><span class="toc-section-number">1.6</span> Exercises</a>
<ul>
<li><a href="1-6-exercises-first-app.html#addition-app---ui"><span class="toc-section-number">1.6.1</span> Addition App - UI</a></li>
<li><a href="1-6-exercises-first-app.html#observeevent"><span class="toc-section-number">1.6.2</span> observeEvent</a></li>
<li><a href="1-6-exercises-first-app.html#reactive"><span class="toc-section-number">1.6.3</span> reactive</a></li>
</ul></li>
</ul></li>
<li class="appendix"><span><b>Appendices</b></span></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="app-structure" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> App Structure</h2>
<p>Now that we’ve made and modified our first working app, it’s time to learn a bit about how a shiny app is structured.</p>
<p>A shiny app is made of two main parts, a <a class='glossary' target='_blank' title='The User Interface. This usually refers to a Shiny App as the user will see it.' href='https://psyteachr.github.io/glossary/u#ui'>UI</a>, which defines what the user interface looks like, and a <a class='glossary' target='_blank' title='This is the part of a Shiny app that works with logic.' href='https://psyteachr.github.io/glossary/s#server'>server</a> function, which defines how the interface behaves. The function <code><span class="fu">shinyApp</span>()</code> puts the two together to run the application in a web browser.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="1-2-app-structure.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setup ----</span></span>
<span id="cb16-2"><a href="1-2-app-structure.html#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(shiny)</span>
<span id="cb16-3"><a href="1-2-app-structure.html#cb16-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4"><a href="1-2-app-structure.html#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define UI ----</span></span>
<span id="cb16-5"><a href="1-2-app-structure.html#cb16-5" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>()</span>
<span id="cb16-6"><a href="1-2-app-structure.html#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="1-2-app-structure.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Define server logic ----</span></span>
<span id="cb16-8"><a href="1-2-app-structure.html#cb16-8" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {}</span>
<span id="cb16-9"><a href="1-2-app-structure.html#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="1-2-app-structure.html#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Run the application ----</span></span>
<span id="cb16-11"><a href="1-2-app-structure.html#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="fu">shinyApp</span>(<span class="at">ui =</span> ui, <span class="at">server =</span> server)</span></code></pre></div>
<div class="try">
<p>Create a new app called “basic_demo” and replace all the text in app.R with the code above. You should be able to run the app and see just a blank page.</p>
</div>
<div id="ui" class="section level3" number="1.2.1">
<h3><span class="header-section-number">1.2.1</span> UI</h3>
<p>The UI is created by one of the ui-building <code>****Page()</code> functions, such as <code><span class="fu">fluidPage</span>()</code>, <code><span class="fu">fixedPage</span>()</code>, <code><span class="fu">fillPage</span>()</code> or <code><span class="fu">dashboardPage</span>()</code> (which we’ll learn more about in Section <a href="#shinydashboard"><strong>??</strong></a>). The ui-building functions set up the parts of the webpage, which are created by more shiny functions that you list inside of the page function, separated by commas.</p>
</div>
<div id="tags" class="section level3" number="1.2.2">
<h3><span class="header-section-number">1.2.2</span> Tags</h3>
<p>For example, the code below displays:</p>
<ol style="list-style-type: decimal">
<li>a title panel with the text “Basic Demo”</li>
<li>a level-two header with the text “My favourite things”</li>
<li>an unordered list containing several list items</li>
<li>a paragraph with the text “This is a very basic demo.”</li>
<li>an image of the <code class='package'>shinyintro</code> logo with a width and height of 100 pixels</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="1-2-app-structure.html#cb17-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(</span>
<span id="cb17-2"><a href="1-2-app-structure.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">titlePanel</span>(<span class="st">&quot;Basic Demo&quot;</span>),</span>
<span id="cb17-3"><a href="1-2-app-structure.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">h2</span>(<span class="st">&quot;My favourite things&quot;</span>),</span>
<span id="cb17-4"><a href="1-2-app-structure.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">ul</span>(tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">&quot;Coding&quot;</span>),</span>
<span id="cb17-5"><a href="1-2-app-structure.html#cb17-5" aria-hidden="true" tabindex="-1"></a>          tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">&quot;Cycling&quot;</span>),</span>
<span id="cb17-6"><a href="1-2-app-structure.html#cb17-6" aria-hidden="true" tabindex="-1"></a>          tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">&quot;Cooking&quot;</span>)),</span>
<span id="cb17-7"><a href="1-2-app-structure.html#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">p</span>(<span class="st">&quot;This is a very basic demo.&quot;</span>),</span>
<span id="cb17-8"><a href="1-2-app-structure.html#cb17-8" aria-hidden="true" tabindex="-1"></a>  tags<span class="sc">$</span><span class="fu">img</span>(</span>
<span id="cb17-9"><a href="1-2-app-structure.html#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">src =</span> <span class="st">&quot;https://debruine.github.io/shinyintro/images/shinyintro.png&quot;</span>,</span>
<span id="cb17-10"><a href="1-2-app-structure.html#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="st">&quot;100px&quot;</span>,</span>
<span id="cb17-11"><a href="1-2-app-structure.html#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="st">&quot;100px&quot;</span></span>
<span id="cb17-12"><a href="1-2-app-structure.html#cb17-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb17-13"><a href="1-2-app-structure.html#cb17-13" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Many of the functions used to create parts of the website are the same as <a class='glossary' target='_blank' title='A way to mark the start and end of HTML elements.' href='https://psyteachr.github.io/glossary/t#tag'>HTML tags</a>, which are ways to mark the beginning and end of different types of text. Most HTML tags are available in shiny by using one of the <code><span class="fu">tags</span>()</code> sub-functions, but some of the more common tags, like <code><span class="fu">p</span>()</code> or <code><span class="fu">h1</span>()</code>-<code><span class="fu">h6</span>()</code>also have a version where you can omit the <code>tags$</code> part. You can see a list of all of the tags available in Shiny at the <a href="https://shiny.rstudio.com/articles/tag-glossary.html" target="_blank">tag glossary</a></p>
<div class="try">
<p>Add the code above to your basic_demo app and replace my favourite things with yours. Make the list an ordered list (instead of unordered) and change the image size.</p>
</div>
</div>
<div id="page-layout" class="section level3" number="1.2.3">
<h3><span class="header-section-number">1.2.3</span> Page Layout</h3>
<p>You usually want your apps to have a more complex layout than just each element stacked below the previous one. The code below wraps the elements after the title panel inside <code><span class="fu">flowLayout</span>()</code>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="1-2-app-structure.html#cb18-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(<span class="fu">titlePanel</span>(<span class="st">&quot;Basic Demo&quot;</span>),</span>
<span id="cb18-2"><a href="1-2-app-structure.html#cb18-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">flowLayout</span>(</span>
<span id="cb18-3"><a href="1-2-app-structure.html#cb18-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">h2</span>(<span class="st">&quot;My favourite things&quot;</span>),</span>
<span id="cb18-4"><a href="1-2-app-structure.html#cb18-4" aria-hidden="true" tabindex="-1"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">&quot;Coding&quot;</span>),</span>
<span id="cb18-5"><a href="1-2-app-structure.html#cb18-5" aria-hidden="true" tabindex="-1"></a>                          tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">&quot;Cycling&quot;</span>),</span>
<span id="cb18-6"><a href="1-2-app-structure.html#cb18-6" aria-hidden="true" tabindex="-1"></a>                          tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">&quot;Cooking&quot;</span>)),</span>
<span id="cb18-7"><a href="1-2-app-structure.html#cb18-7" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">p</span>(<span class="st">&quot;This is a very basic demo.&quot;</span>),</span>
<span id="cb18-8"><a href="1-2-app-structure.html#cb18-8" aria-hidden="true" tabindex="-1"></a>                  tags<span class="sc">$</span><span class="fu">img</span>(</span>
<span id="cb18-9"><a href="1-2-app-structure.html#cb18-9" aria-hidden="true" tabindex="-1"></a>                    <span class="at">src =</span> <span class="st">&quot;https://debruine.github.io/shinyintro/images/shinyintro.png&quot;</span>,</span>
<span id="cb18-10"><a href="1-2-app-structure.html#cb18-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">width =</span> <span class="st">&quot;100px&quot;</span>,</span>
<span id="cb18-11"><a href="1-2-app-structure.html#cb18-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">height =</span> <span class="st">&quot;100px&quot;</span></span>
<span id="cb18-12"><a href="1-2-app-structure.html#cb18-12" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb18-13"><a href="1-2-app-structure.html#cb18-13" aria-hidden="true" tabindex="-1"></a>                ))</span></code></pre></div>
<div class="try">
<p>Replace the ui code in your basic_demo app with the code above and run it in a web browser. What happens when you change the width of the web browser? Change <code><span class="fu">flowLayout</span>()</code> to <code><span class="fu">verticalLayout</span>()</code> or <code><span class="fu">splitLayout</span>()</code> and see what changes.</p>
</div>
<p>You can use a <code><span class="fu">sidebarLayout</span>()</code> to arrange your elements into a <code><span class="fu">sidebarPanel</span>()</code> and a <code><span class="fu">mainPanel</span>()</code>. If the browser width is too narrow, the sidebar will display on top of the main panel.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="1-2-app-structure.html#cb19-1" aria-hidden="true" tabindex="-1"></a>ui <span class="ot">&lt;-</span> <span class="fu">fluidPage</span>(<span class="fu">titlePanel</span>(<span class="st">&quot;Basic Demo&quot;</span>),</span>
<span id="cb19-2"><a href="1-2-app-structure.html#cb19-2" aria-hidden="true" tabindex="-1"></a>                <span class="fu">sidebarLayout</span>(<span class="fu">sidebarPanel</span>(</span>
<span id="cb19-3"><a href="1-2-app-structure.html#cb19-3" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">h2</span>(<span class="st">&quot;My favourite things&quot;</span>),</span>
<span id="cb19-4"><a href="1-2-app-structure.html#cb19-4" aria-hidden="true" tabindex="-1"></a>                  tags<span class="sc">$</span><span class="fu">ul</span>(tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">&quot;Coding&quot;</span>),</span>
<span id="cb19-5"><a href="1-2-app-structure.html#cb19-5" aria-hidden="true" tabindex="-1"></a>                          tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">&quot;Cycling&quot;</span>),</span>
<span id="cb19-6"><a href="1-2-app-structure.html#cb19-6" aria-hidden="true" tabindex="-1"></a>                          tags<span class="sc">$</span><span class="fu">li</span>(<span class="st">&quot;Cooking&quot;</span>))</span>
<span id="cb19-7"><a href="1-2-app-structure.html#cb19-7" aria-hidden="true" tabindex="-1"></a>                ),</span>
<span id="cb19-8"><a href="1-2-app-structure.html#cb19-8" aria-hidden="true" tabindex="-1"></a>                <span class="fu">mainPanel</span>(</span>
<span id="cb19-9"><a href="1-2-app-structure.html#cb19-9" aria-hidden="true" tabindex="-1"></a>                  <span class="fu">p</span>(<span class="st">&quot;This is a very basic demo.&quot;</span>),</span>
<span id="cb19-10"><a href="1-2-app-structure.html#cb19-10" aria-hidden="true" tabindex="-1"></a>                  tags<span class="sc">$</span><span class="fu">img</span>(</span>
<span id="cb19-11"><a href="1-2-app-structure.html#cb19-11" aria-hidden="true" tabindex="-1"></a>                    <span class="at">src =</span> <span class="st">&quot;https://debruine.github.io/shinyintro/images/shinyintro.png&quot;</span>,</span>
<span id="cb19-12"><a href="1-2-app-structure.html#cb19-12" aria-hidden="true" tabindex="-1"></a>                    <span class="at">width =</span> <span class="st">&quot;100px&quot;</span>,</span>
<span id="cb19-13"><a href="1-2-app-structure.html#cb19-13" aria-hidden="true" tabindex="-1"></a>                    <span class="at">height =</span> <span class="st">&quot;100px&quot;</span></span>
<span id="cb19-14"><a href="1-2-app-structure.html#cb19-14" aria-hidden="true" tabindex="-1"></a>                  )</span>
<span id="cb19-15"><a href="1-2-app-structure.html#cb19-15" aria-hidden="true" tabindex="-1"></a>                )))</span></code></pre></div>
</div>
</div>
<p style="text-align: center;">
<a href="1-1-the-demo-app.html"><button class="btn btn-default">Previous</button></a>
<a href="1-3-dynamic-elements.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>

<div class="psyteachr_footer">
  
</div>
<script>

/* update total correct if #webex-total_correct exists */
update_total_correct = function() {
  if (t = document.getElementById("webex-total_correct")) {
    t.innerHTML =
      document.getElementsByClassName("webex-correct").length + " of " +
      document.getElementsByClassName("webex-solveme").length + " correct";
  }
}

/* webex-solution button toggling function */
b_func = function() {
  var cl = this.parentElement.classList;
  if (cl.contains('open')) {
    cl.remove("open");
  } else {
    cl.add("open");
  }
}

/* function for checking solveme answers */
solveme_func = function(e) {
  var real_answers = JSON.parse(this.dataset.answer);
  var my_answer = this.value;
  var cl = this.classList;
  if (cl.contains("ignorecase")) {
    my_answer = my_answer.toLowerCase();
  }
  if (cl.contains("nospaces")) {
    my_answer = my_answer.replace(/ /g, "")
  }
  
  if (my_answer == "") {
    cl.remove("webex-correct");
    cl.remove("webex-incorrect");
  } else if (real_answers.includes(my_answer)) {
    cl.add("webex-correct");
    cl.remove("webex-incorrect");
  } else {
    cl.add("webex-incorrect");
    cl.remove("webex-correct");
  }

  // match numeric answers within a specified tolerance
  if(this.dataset.tol > 0){
    var tol = JSON.parse(this.dataset.tol);  
    var matches = real_answers.map(x => Math.abs(x - my_answer) < tol)
    if (matches.reduce((a, b) => a + b, 0) > 0) {
      cl.add("webex-correct");
    } else {
      cl.remove("webex-correct");
    }  
  }

  // added regex bit
  if (cl.contains("regex")){
    answer_regex = RegExp(real_answers.join("|"))
    if (answer_regex.test(my_answer)) {
      cl.add("webex-correct");
    }  
  }
  
  update_total_correct();
}

window.onload = function() {
  /* set up solution buttons */
  var buttons = document.getElementsByTagName("button");

  for (var i = 0; i < buttons.length; i++) {
    if (buttons[i].parentElement.classList.contains('webex-solution')) {
      buttons[i].onclick = b_func;
    }
  }
  
  /* set up webex-solveme inputs */
  var solveme = document.getElementsByClassName("webex-solveme");

  for (var i = 0; i < solveme.length; i++) {
    /* make sure input boxes don't auto-anything */
    solveme[i].setAttribute("autocomplete","off");
    solveme[i].setAttribute("autocorrect", "off");
    solveme[i].setAttribute("autocapitalize", "off"); 
    solveme[i].setAttribute("spellcheck", "false");
    solveme[i].value = "";
    
    /* adjust answer for ignorecase or nospaces */
    var cl = solveme[i].classList;
    var real_answer = solveme[i].dataset.answer;
    if (cl.contains("ignorecase")) {
      real_answer = real_answer.toLowerCase();
    }
    if (cl.contains("nospaces")) {
      real_answer = real_answer.replace(/ /g, "");
    }
    solveme[i].dataset.answer = real_answer;
    
    /* attach checking function */
    solveme[i].onkeyup = solveme_func;
    solveme[i].onchange = solveme_func;
  }
  
  update_total_correct();
}

</script>


</body>
</html>
